generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlserver"
  url      = "sqlserver://192.168.27.12:1433;database=PersistentCart;user={myvisitmaker};password={$ystempassoword*1};encrypt=true;trustServerCertificate=true"
}

model session {
  id            String    @id
  shop          String
  state         String
  isOnline      Boolean   @default(false)
  scope         String?
  expires       DateTime?
  accessToken   String
  userId        BigInt?
  firstName     String?
  lastName      String?
  email         String?
  accountOwner  Boolean   @default(false)
  locale        String?
  collaborator  Boolean?  @default(false)
  emailVerified Boolean?  @default(false)
}

model Shop {
  id            Int       @id @default(autoincrement())
  shopifyDomain String    @unique
  accessToken   String
  shopName      String?
  email         String?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @default(now())
  customers     Customer[]
}

model Customer {
  id                Int       @id @default(autoincrement())
  shopifyCustomerId BigInt
  shopId            Int
  email             String?
  firstName         String?
  lastName          String?
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @default(now())
  shop              Shop      @relation(fields: [shopId], references: [id])

  @@unique([shopifyCustomerId, shopId])
}

model PersistentCart {
  id                   Int       @id @default(autoincrement())
  shopifyDomain        String
  shopifyCustomerId    BigInt
  customerEmail        String
  cartJson             String
  cartToken            String
  totalLineItemsCount  Int
  totalPrice           Int
  cartStatus           String    @default("active")
  lastUpdated          DateTime  @default(now())
  createdAt            DateTime  @default(now())

  @@unique([shopifyDomain, shopifyCustomerId])
}
